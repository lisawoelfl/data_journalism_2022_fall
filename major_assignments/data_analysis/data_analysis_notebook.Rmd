---
title: "Data Analysis"
author: "Abby Wallace, Lisa Woelfl, Torrence Banks, Noah Ferguson"
date: "11/11/2022"
output:
  html_document:
    theme: cerulean
    highlight: pygments
    toc: true
    toc_float:
      collapsed: true
      smooth_scroll: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction 

In this notebook, we are analyzing data from the Maryland Lobbying Registrations. [https://lobby-ethics.maryland.gov/]

## Load libraries

```{r echo=FALSE, message=FALSE}
# Load the tidyverse here
library(tidyverse)
# Load janitor here
library(janitor)
library(lubridate)
library(stringr)
library(dplyr)
library(tidyr)
```

## Load and Cleaning Data

```{r}
# Loading the dataframes and binding them together

one <- read_csv("data/registrations(1).csv") %>% clean_names()
two <- read_csv("data/registrations(2).csv") %>% clean_names()
three <- read_csv("data/registrations(3).csv") %>% clean_names()
four<- read_csv("data/registrations(4).csv") %>% clean_names()
five <- read_csv("data/registrations(5).csv")%>% clean_names()
six <- read_csv("data/registrations(6).csv")%>% clean_names()
seven <- read_csv("data/registrations(7).csv")%>% clean_names()
eight <- read_csv("data/registrations(8).csv")%>% clean_names()
nine <- read_csv("data/registrations(9).csv")%>% clean_names()

total_registrations <- rbind(one, two, three, four, five, six, seven, eight, nine)

write_csv(total_registrations, "data/total_registrations.csv")

# We cleaned the data in OpenRefine and split the date column

clean_total_registrations <- read_csv("data/clean_total_registrations.csv")
clean_total_registrations[c('start', 'end')] <- str_split_fixed(clean_total_registrations$registration_period, '-', 2)
```

## Basic explorations

```{r}
glimpse(clean_total_registrations)
```

The original dataframe had 12855 rows and 5 columns. Our cleaned dataframe has 12855 rows and 9 columns (we added cleaned columns for organization name & employer and split the date column to have a start and end date for the registration).

The data looked pretty clean in OpenRefine. We found just a handful of names to clean up.

Limitations: The dataframe is pretty basic with a small number of columns. That means we will have to cross-reference the website, if we want to know how much a lobbyist is making or how much an employer is spending on lobbying. The standard dataset doesn't even include the registration matters. For our topical questions, we have to download new datasets for every registration matter we're interested in. Another limitation is that the earliest data is from 2019, which means we can't look at long-term trends.

To answer most of our questions, we will have to do additional research. For example, we can ask the number of employers and lobbyists in the energy sector and see how that changed over the last few years. To examine how much the top firms make, we have to go back to the website.

When looking into the PG county youth curfew, we won't get clear cut answers from the data alone. Trying to find a connection between the number of lobbyists for matters of juvenile law and the implementation of the curfew will require additional research on our part.

### Question 1



* **Question text**: 
* **Analysis summary**:



### Question 4

* **Question text**: How did the number of employers and lobbyists registered for "energy" change from 2018 to 2022?

Starting with the basic analysis of lobbyist registrations categorized under the registration matter "energy", we want to explore lobbying efforts in the energy sector. Follow-up questions include: Which firms had the most employers in our time frame? How much money did the top 3 firms make from employers in the energy sector (in 2022)? Who are their employers? Are they part of fossil fuels, clean energy or others?

Limitations: Although the general dataset on registrations goes back to 2015, datasets including the registration matter only go back to 2019.

**Analysis summary**: As our data shows, 106 lobbyists have registered for "energy" in 106, 132 in 2020, 123 in 2021 and 2022 in 115. One could have assumed that since the climate crisis has been big news in recent years that there would have been more lobbyists, which doesn't seem to be the case. The numbers has been reclining since 2020. Since 2020 was the first pandemic year, there could be a connection. Did employers have less money to spend on lobbying?

Interestingly, while the number of lobbyists declined, the number of employers grew before 2022. In 2019 there were 66 employers, in 2020 88, in 2021 85 and in 2022 there were 78 employers in the registration matter category "energy".

The 3 firms with the most employers registered for energy lobbying since 2019 are:
- Compass Government Relations Partners, LLC (10 employers)
- Perry White Ross & Jacobson (8 employers)
- Rifkin Weiner Livingston LLC (8 employers)

Next steps for this portions include getting new data from the "Maryland Lobbying Registrations"-Website to look through "energy" employers and their spending. Also, looking at the newer registrants and see who they represent.

```{r}
## The dataset has been cleaned in OpenRefine. We clean the names and split the date column, so we have a start and an end date for the registration.

energy_registrations <- read_csv("data/clean_energy-registrations.csv") %>% clean_names()
energy_registrations[c('start', 'end')] <- str_split_fixed(energy_registrations$registration_period, '-', 2)

```

```{r}
## Then we transform our new colums from characters to dates and create a floor date to make grouping by year possible.

energy_registrations <- energy_registrations %>% 
  mutate(new_start = as.Date(start, format = "%m/%d/%y")) %>% 
  mutate(new_end = as.Date(end, format = "%m/%d/%y")) %>% 
  mutate(start_year = floor_date(new_start, "year"))
```

```{r}
## To make sure we don't count some lobbyists twice in a year (they do sometimes register multiple times for short periods in a year), we use n_distinct.

year_energy_registrations <- energy_registrations %>% 
  group_by(start_year) %>%
  summarise(count = n_distinct(clean_lobbyist_registrant))
year_energy_registrations
```

```{r}
## We repeat the code, only this time we are looking for the number of employers lobbyists registered with.

year_energy_employers <- energy_registrations %>% 
  group_by(start_year) %>%
  summarise(count = n_distinct(clean_employer))
year_energy_employers
```


```{r}
## We want to know which firms had the most employers in our timeframe (2019-2022). We grouped by firms, counted employers and arranged the data.

employer_energy <- energy_registrations %>% 
  group_by(clean_organization_firm) %>% 
  summarise(count = n_distinct(clean_employer)) %>% 
  arrange(desc(count))
employer_energy
```
```{r}

## Let's see who those firms work for

top_three <- energy_registrations %>% 
  filter(clean_organization_firm == c("Compass Government Relations Partners, LLC", "Perry White Ross & Jacobson", "Rifkin Weiner Livingston LLC")) %>% 
  select(clean_organization_firm, clean_employer) %>% 
  arrange(clean_organization_firm)
top_three
```
```
  
  